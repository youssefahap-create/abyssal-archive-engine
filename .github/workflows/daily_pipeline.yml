name: Automated YouTube Channel Pipeline
on:
  schedule:
    - cron: '0 12,15,18,21 * * *'  # أوقات النشر: 12, 3, 6, 9 مساءً UTC
  workflow_dispatch:

permissions:
  contents: write

jobs:
  generate-and-upload:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout repository
      uses: actions/checkout@v4
      with:
        token: ${{ secrets.GITHUB_TOKEN }}
    
    - name: Setup Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.10'
    
    - name: Install system dependencies
      run: |
        sudo apt-get update
        sudo apt-get install -y ffmpeg imagemagick libmagickwand-dev
        sudo apt-get install -y xvfb libfontconfig1 libfreetype6
    
    - name: Install Python dependencies
      run: |
        python -m pip install --upgrade pip
        pip install -r requirements.txt
    
    - name: Generate daily content
      env:
        # جميع API keys
        ELEVEN_API_KEY_1: ${{ secrets.ELEVEN_API_KEY_1 }}
        ELEVEN_API_KEY_2: ${{ secrets.ELEVEN_API_KEY_2 }}
        ELEVEN_API_KEY_3: ${{ secrets.ELEVEN_API_KEY_3 }}
        GROQ_API_KEY: ${{ secrets.GROQ_API_KEY }}
        OPENAI_API_KEY_1: ${{ secrets.OPENAI_API_KEY_1 }}
        OPENAI_API_KEY_2: ${{ secrets.OPENAI_API_KEY_2 }}
        PEXELS_API_KEY: ${{ secrets.PEXELS_API_KEY }}
        PIXABAY_API_KEY: ${{ secrets.PIXABAY_API_KEY }}
        UNSPLASH_ACCESS_KEY: ${{ secrets.UNSPLASH_ACCESS_KEY }}
        UNSPLASH_SECRET_KEY: ${{ secrets.UNSPLASH_SECRET_KEY }}
        UNSPLASH_ID: ${{ secrets.UNSPLASH_ID }}
        YT_CLIENT_ID_1: ${{ secrets.YT_CLIENT_ID_1 }}
        YT_CLIENT_SECRET_1: ${{ secrets.YT_CLIENT_SECRET_1 }}
        YT_REFRESH_TOKEN_1: ${{ secrets.YT_REFRESH_TOKEN_1 }}
        YT_CLIENT_ID_2: ${{ secrets.YT_CLIENT_ID_2 }}
        YT_CLIENT_SECRET_2: ${{ secrets.YT_CLIENT_SECRET_2 }}
        YT_REFRESH_TOKEN_2: ${{ secrets.YT_REFRESH_TOKEN_2 }}
        YT_CHANNEL_ID: ${{ secrets.YT_CHANNEL_ID }}
        GEMINI_API_KEY_1: ${{ secrets.GEMINI_API_KEY_1 }}
        GEMINI_API_KEY_2: ${{ secrets.GEMINI_API_KEY_2 }}
        NEWS_API: ${{ secrets.NEWS_API }}
        TAVILY_API_KEY: ${{ secrets.TAVILY_API_KEY }}
        CAMB_AI_KEY_1: ${{ secrets.CAMB_AI_KEY_1 }}
        CLOUDINARY_API_KEY: ${{ secrets.CLOUDINARY_API_KEY }}
        COVERR_API_ID: ${{ secrets.COVERR_API_ID }}
        COVERR_API_KEY: ${{ secrets.COVERR_API_KEY }}
        FREEPIK_API_KEY: ${{ secrets.FREEPIK_API_KEY }}
        FREESOUND_API: ${{ secrets.FREESOUND_API }}
        FREESOUND_ID: ${{ secrets.FREESOUND_ID }}
        GETIMG_API_KEY_1: ${{ secrets.GETIMG_API_KEY_1 }}
        GETIMG_API_KEY_2: ${{ secrets.GETIMG_API_KEY_2 }}
        HF_API_TOKEN_1: ${{ secrets.HF_API_TOKEN_1 }}
        INTERNET_ARCHIVE_ACCESS_KEY: ${{ secrets.INTERNET_ARCHIVE_ACCESS_KEY }}
        INTERNET_ARCHIVE_SECRET_KEY: ${{ secrets.INTERNET_ARCHIVE_SECRET_KEY }}
        NASA_API_KEY: ${{ secrets.NASA_API_KEY }}
        NOAA_API_KEY: ${{ secrets.NOAA_API_KEY }}
        OPENROUTER_KEY: ${{ secrets.OPENROUTER_KEY }}
        REMOVE_BG_API: ${{ secrets.REMOVE_BG_API }}
        REPLICATE_API_TOKEN_1: ${{ secrets.REPLICATE_API_TOKEN_1 }}
        REPLICATE_API_TOKEN_2: ${{ secrets.REPLICATE_API_TOKEN_2 }}
        TELEGRAM_BOT_TOKEN: ${{ secrets.TELEGRAM_BOT_TOKEN }}
        TELEGRAM_CHAT_ID: ${{ secrets.TELEGRAM_CHAT_ID }}
        VECTEEZY_API_KEY: ${{ secrets.VECTEEZY_API_KEY }}
        VECTEEZY_ID_KEY: ${{ secrets.VECTEEZY_ID_KEY }}
        YOUTUBE_API_KEY: ${{ secrets.YOUTUBE_API_KEY }}
      run: |
        python main.py
    
    - name: Commit and push generated content
      run: |
        git config --local user.email "github-actions@github.com"
        git config --local user.name "GitHub Actions"
        git add storage/
        git add logs/
        git commit -m "Auto-generated content for $(date +'%Y-%m-%d')" || echo "No changes to commit"
        git push
