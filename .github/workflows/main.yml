
name: Abyssal Archive Content Engine
on:
  workflow_dispatch: # Allows manual triggering for testing
  schedule:
    # 2 PM EST is roughly 6 PM UTC, 7 PM EST is 11 PM UTC, 2 AM EST is 6 AM UTC
    - cron: '0 6 * * *'   # 6 AM UTC (2 AM EST) - Night Mode Video
    - cron: '0 18 * * *'  # 6 PM UTC (2 PM EST) - Prime Time Video 1
    - cron: '0 23 * * *'  # 11 PM UTC (7 PM EST) - Prime Time Video 2

jobs:
  build-and-upload-video:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout Repository
        uses: actions/checkout@v4

      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.11'

      - name: Install System Dependencies (FFmpeg, ImageMagick)
        run: sudo apt-get update && sudo apt-get install -y ffmpeg imagemagick

      - name: Install Python Dependencies
        run: |
          python -m pip install --upgrade pip
          pip install -r requirements.txt

      - name: Run The Content Engine
        id: content_engine
        run: python src/main.py
        env:
          # This is where all the secrets from GitHub Secrets will be mapped
          # Ensure all keys from the user's list are mapped here.
          CAMB_AI_KEY_1: ${{ secrets.CAMB_AI_KEY_1 }}
          CLOUDINARY_API_KEY: ${{ secrets.CLOUDINARY_API_KEY }}
          COVERR_API_ID: ${{ secrets.COVERR_API_ID }}
          COVERR_API_KEY: ${{ secrets.COVERR_API_KEY }}
          ELEVEN_API_KEY_1: ${{ secrets.ELEVEN_API_KEY_1 }}
          GEMINI_API_KEY_1: ${{ secrets.GEMINI_API_KEY_1 }}
          GETIMG_API_KEY_1: ${{ secrets.GETIMG_API_KEY_1 }}
          GROQ_API_KEY: ${{ secrets.GROQ_API_KEY }}
          HF_API_TOKEN_1: ${{ secrets.HF_API_TOKEN_1 }}
          INTERNET_ARCHIVE_ACCESS_KEY: ${{ secrets.INTERNET_ARCHIVE_ACCESS_KEY }}
          INTERNET_ARCHIVE_SECRET_KEY: ${{ secrets.INTERNET_ARCHIVE_SECRET_KEY }}
          NASA_API_KEY: ${{ secrets.NASA_API_KEY }}
          NEWS_API: ${{ secrets.NEWS_API }}
          NOAA_API_KEY: ${{ secrets.NOAA_API_KEY }}
          OPENAI_API_KEY_1: ${{ secrets.OPENAI_API_KEY_1 }}
          PEXELS_API_KEY: ${{ secrets.PEXELS_API_KEY }}
          PIXABAY_API_KEY: ${{ secrets.PIXABAY_API_KEY }}
          REMOVE_BG_API: ${{ secrets.REMOVE_BG_API }}
          REPLICATE_API_TOKEN_1: ${{ secrets.REPLICATE_API_TOKEN_1 }}
          TAVILY_API_KEY: ${{ secrets.TAVILY_API_KEY }}
          TELEGRAM_BOT_TOKEN: ${{ secrets.TELEGRAM_BOT_TOKEN }}
          TELEGRAM_CHAT_ID: ${{ secrets.TELEGRAM_CHAT_ID }}
          YOUTUBE_API_KEY: ${{ secrets.YOUTUBE_API_KEY }}
          YT_CHANNEL_ID: ${{ secrets.YT_CHANNEL_ID }}
          YT_CLIENT_ID_1: ${{ secrets.YT_CLIENT_ID_1 }}
          YT_CLIENT_ID_2: ${{ secrets.YT_CLIENT_ID_2 }}
          YT_CLIENT_SECRET_1: ${{ secrets.YT_CLIENT_SECRET_1 }}
          YT_CLIENT_SECRET_2: ${{ secrets.YT_CLIENT_SECRET_2 }}
          YT_REFRESH_TOKEN_1: ${{ secrets.YT_REFRESH_TOKEN_1 }}
          YT_REFRESH_TOKEN_2: ${{ secrets.YT_REFRESH_TOKEN_2 }}
