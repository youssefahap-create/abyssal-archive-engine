name: Daily YouTube Production Cycle

on:
  schedule:
    # Run twice daily at 6 AM and 1 PM EST (11 AM and 6 PM UTC)
    - cron: '0 11 * * *'   # 6 AM EST
    - cron: '0 18 * * *'   # 1 PM EST
  workflow_dispatch:  # Allow manual trigger

jobs:
  build:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout repository
      uses: actions/checkout@v4

    - name: Set up Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.11'

    - name: Install dependencies
      run: |
        python -m pip install --upgrade pip
        pip install -r requirements.txt
      continue-on-error: true

    - name: Run YouTube Automation
      env:
        CAMB_AI_KEY_1: ${{ secrets.CAMB_AI_KEY_1 }}
        CLOUDINARY_API_KEY: ${{ secrets.CLOUDINARY_API_KEY }}
        COVERR_API_ID: ${{ secrets.COVERR_API_ID }}
        COVERR_API_KEY: ${{ secrets.COVERR_API_KEY }}
        ELEVEN_API_KEY_1: ${{ secrets.ELEVEN_API_KEY_1 }}
        ELEVEN_API_KEY_2: ${{ secrets.ELEVEN_API_KEY_2 }}
        ELEVEN_API_KEY_3: ${{ secrets.ELEVEN_API_KEY_3 }}
        FREEPIK_API_KEY: ${{ secrets.FREEPIK_API_KEY }}
        FREESOUND_API: ${{ secrets.FREESOUND_API }}
        FREESOUND_ID: ${{ secrets.FREESOUND_ID }}
        GEMINI_API_KEY_1: ${{ secrets.GEMINI_API_KEY_1 }}
        GEMINI_API_KEY_2: ${{ secrets.GEMINI_API_KEY_2 }}
        GETIMG_API_KEY_1: ${{ secrets.GETIMG_API_KEY_1 }}
        GETIMG_API_KEY_2: ${{ secrets.GETIMG_API_KEY_2 }}
        GROQ_API_KEY: ${{ secrets.GROQ_API_KEY }}
        HF_API_TOKEN_1: ${{ secrets.HF_API_TOKEN_1 }}
        INTERNET_ARCHIVE_ACCESS_KEY: ${{ secrets.INTERNET_ARCHIVE_ACCESS_KEY }}
        INTERNET_ARCHIVE_SECRET_KEY: ${{ secrets.INTERNET_ARCHIVE_SECRET_KEY }}
        NASA_API_KEY: ${{ secrets.NASA_API_KEY }}
        NEWS_API: ${{ secrets.NEWS_API }}
        NOAA_API_KEY: ${{ secrets.NOAA_API_KEY }}
        OPENAI_API_KEY_1: ${{ secrets.OPENAI_API_KEY_1 }}
        OPENAI_API_KEY_2: ${{ secrets.OPENAI_API_KEY_2 }}
        OPENROUTER_KEY: ${{ secrets.OPENROUTER_KEY }}
        PEXELS_API_KEY: ${{ secrets.PEXELS_API_KEY }}
        PIXABAY_API_KEY: ${{ secrets.PIXABAY_API_KEY }}
        REMOVE_BG_API: ${{ secrets.REMOVE_BG_API }}
        REPLICATE_API_TOKEN_1: ${{ secrets.REPLICATE_API_TOKEN_1 }}
        REPLICATE_API_TOKEN_2: ${{ secrets.REPLICATE_API_TOKEN_2 }}
        TAVILY_API_KEY: ${{ secrets.TAVILY_API_KEY }}
        TELEGRAM_BOT_TOKEN: ${{ secrets.TELEGRAM_BOT_TOKEN }}
        TELEGRAM_CHAT_ID: ${{ secrets.TELEGRAM_CHAT_ID }}
        UNSPLASH_ACCESS_KEY: ${{ secrets.UNSPLASH_ACCESS_KEY }}
        UNSPLASH_ID: ${{ secrets.UNSPLASH_ID }}
        UNSPLASH_SECRET_KEY: ${{ secrets.UNSPLASH_SECRET_KEY }}
        VECTEEZY_API_KEY: ${{ secrets.VECTEEZY_API_KEY }}
        VECTEEZY_ID_KEY: ${{ secrets.VECTEEZY_ID_KEY }}
        YOUTUBE_API_KEY: ${{ secrets.YOUTUBE_API_KEY }}
        YT_CHANNEL_ID: ${{ secrets.YT_CHANNEL_ID }}
        YT_CLIENT_ID_1: ${{ secrets.YT_CLIENT_ID_1 }}
        YT_CLIENT_ID_2: ${{ secrets.YT_CLIENT_ID_2 }}
        YT_CLIENT_SECRET_1: ${{ secrets.YT_CLIENT_SECRET_1 }}
        YT_CLIENT_SECRET_2: ${{ secrets.YT_CLIENT_SECRET_2 }}
        YT_REFRESH_TOKEN_1: ${{ secrets.YT_REFRESH_TOKEN_1 }}
        YT_REFRESH_TOKEN_2: ${{ secrets.YT_REFRESH_TOKEN_2 }}
      run: |
        python -m src.main

    - name: Upload artifacts
      uses: actions/upload-artifact@v3
      if: always()
      with:
        name: production-output-${{ github.run_number }}
        path: |
          assets/
          data/logs/
        retention-days: 7
